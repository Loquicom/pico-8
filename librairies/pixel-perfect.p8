pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--gameloop

function _init()
    player = {
        x = 10,
        y = 60,
        sprt = 2
    }
    obj = {
        x = 60,
        y = 60,
        sprt = 1
    }
    collision = false
    debug = ""
end

function _update()
    if (btn(0)) player.x-=1 --left
	if (btn(1)) player.x+=1 --right
	if (btn(2)) player.y-=1 --up
	if (btn(3)) player.y+=1 --down
    if (btnp(4)) obj.sprt = ternaire(obj.sprt == 1, 104, 1)
    if (btnp(5)) player.sprt = ternaire(player.sprt == 2, 142, 2)
    collision = collision_pixel(player, obj)
end

function _draw()
    cls()
    spr(player.sprt, player.x, player.y)
    spr(obj.sprt, obj.x, obj.y)
    print(collision, 2, 2, 7)
    print(debug, 2, 8, 7)
end

function collision_pixel(obj1, obj2)
    -- check if objects collide
    if (obj1.x > obj2.x+7 or obj2.x > obj1.x+7 or obj1.y > obj2.y+7 or obj2.y > obj1.y+7) return false
    -- sprite 1 pos in spritesheet
    local line = flr(obj1.sprt / 16)
    local obj1SprtX = (obj1.sprt - (line * 16)) * 8
    local obj1SprtY = line * 8
    -- sprite 2 pos in spritesheet
    line = flr(obj2.sprt / 16)
    local obj2SprtX = (obj2.sprt - (line * 16)) * 8
    local obj2SprtY = line * 8
    -- check if the pixel who collide is not empty
    for i=0,7 do
        for j=0,7 do
            local x = obj1.x+i - obj2.x
            local y = obj1.y+j - obj2.y
            if (x >= 0 and x < 8 and y >= 0 and y < 8 and sget(obj1SprtX+i, obj1SprtY+j) != 0 and sget(obj2SprtX+x, obj2SprtY+y) != 0) return true
        end
    end
    return false
end

function collision_pixel1(obj1, obj2)
    -- Pos sprite Obj1
    local line = flr(obj1.sprt / 16)
    local obj1SprtX = (obj1.sprt - (line * 16)) * 8
    local obj1SprtY = line * 8
    -- Pos sprite Obj2
    line = flr(obj2.sprt / 16)
    local obj2SprtX = (obj2.sprt - (line * 16)) * 8
    local obj2SprtY = line * 8
    -- Check if two pixel of obj1 and obj2 collide
    for i=0,7 do
        for j=0,7 do
            if (obj1.y+i >= obj2.y and obj1.y+i <= obj2.y+7 and obj1.x+j >= obj2.x and obj1.x+j <= obj2.x+7) then
                -- Find the pixel in obj 2 who collide
                local x = obj1.x+j - obj2.x
                local y = obj1.y+i - obj2.y
                if (sget(obj1SprtX+j, obj1SprtY+i) != 0 and sget(obj2SprtX+x, obj2SprtY+y) != 0) then
                    return true
                end
            end
        end
    end
    return false
end

function collision_pixel2(obj1, obj2)
    local obj1Matrix = matrix_sprite(obj1.sprt, obj1.x, obj1.y)
    local obj2Matrix = matrix_sprite(obj2.sprt, obj2.x, obj2.y)
    for indexLine,line in pairs(obj1Matrix) do
        for indexCol,col in pairs(line) do
            if (col != 0 and obj2Matrix[indexLine] != nil and obj2Matrix[indexLine][indexCol] != nil and obj2Matrix[indexLine][indexCol] != 0) return true
        end
    end
    return false
end

function matrix_sprite(sprt, x, y)
    local line = flr(sprt / 16)
    local sprtX = (sprt - (line * 16)) * 8
    local sprtY = line * 8

    local matrix = {}
    for i=0,7 do
        local tab = {}
        for j=0,7 do
            tab[x+j] = sget(sprtX+j, sprtY+i)
        end
        matrix[y+i] = tab
    end

    return matrix
end

function ternaire(cond, val1, val2)
	if (cond) return val1
	return val2
end

__gfx__
00000000990000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000990008888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000990008888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000990000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000bb00000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000bb00000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000bb00000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000bb00000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002022220200000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002220022200000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000220022000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002ff7f2000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002ffff2000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000222222000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002222222200000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002002200200000000
