pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--gameloop

function _init()
	init_ground()
	make_player()
end

function _update()
	update_ground()
	move_player()
end

function _draw()
	cls(1) --clear screen
	draw_background()
	draw_player()
	draw_foreground()
end

-->8
--player

function make_player()
	player = {}
	player.sprite = 1
	player.x = 64
	player.y = 64
	player.speed = 2
end

function move_player()
	-- Detect pressed button set speed end sprite
	local x = 0
	local y = 0
	player.sprite = 1
	if (btn(0)) x -= player.speed
	if (btn(1)) x += player.speed
	if (btn(2)) then 
		y -= player.speed
		player.sprite = 3
	end
	if (btn(3)) then 
		y += player.speed
		player.sprite = 2
	end
	-- Adapt diagonal speed
	if (x != 0 & y != 0) then
		x /= 2
		y /= 2
	end
	-- Set position
	player.x += x
	player.y += y
end

function draw_player()
	spr(player.sprite,player.x,player.y)
end

-->8
--background & foreground

function init_ground()
	planet = {visible = false, speed = 0.8}
	stars = {}
	ligths = {}
	for i=0,flr(rnd(10)+18) do
		add(ligths, {x=flr(rnd(100))+130,y=flr(rnd(127)),color=flr(rnd(2)+5),speed=1.2})
	end
end

function update_ground()
	-- Planet
	if (not planet.visible) then
		-- Show the planet, set the properties
		local type = flr(rnd(3)+0.1)
		if (type == 0) planet.sprite = 12
		if (type == 1) planet.sprite = 14
		if (type == 2) planet.sprite = 44
		if (type == 3) planet.sprite = 46
		planet.visible = true
		planet.x = 200
		planet.y = flr(rnd(127))
	end
	if (planet.visible) then
		if (planet.x < -100) planet.visible = false
		planet.x -= planet.speed
	end
	-- Lights
	for light in all(ligths) do
		if (light.x < -1) then
			light.x = flr(rnd(100))+130
			light.y = flr(rnd(127))
			light.color = flr(rnd(2)+5)
		end
		light.x -= light.speed
		if (light.color == 6) light.x -= 0.2
	end
end

function draw_background()
	if (planet.visible) then
		spr(planet.sprite, planet.x, planet.y)
		spr(planet.sprite+1, planet.x+8, planet.y)
		spr(planet.sprite+16, planet.x, planet.y+8)
		spr(planet.sprite+17, planet.x+8, planet.y+8)
	end
end

function draw_foreground()
	for light in all(ligths) do
		if (light.color == 6) pset(light.x-1, light.y, light.color)
		pset(light.x, light.y, light.color)
	end
end

__gfx__
00000000000660000000000000066000000000000000000000000000000000000000000000000000000000000000000000000077770000000000009999000000
00000000006d600000000000665555d000000000000000000000000000000000000000000000000000000000000000000000cccccccc00000000999799990000
00700700665555d00006600000655f550000000000000000000000000000000000000000000000000000000000000000000cccccccccc00000099999a9999000
0007700000655f55665d6000006555d5000000000000000000000000000000000000000000000000000000000000000000cccccccbcccc000099999999999900
0007700000655f55006555d5665d600000000000000000000000000000000000000000000000000000000000000000000cccccccccccccc009997aa999aa9990
00700700665555d000655f550006600000000000000000000000000000000000000000000000000000000000000000000ccbbccccbbbccc0099999999aa79990
00000000006d6000665555d0000000000000000000000000000000000000000000000000000000000000000000000000cccbbcccbbbbcccc9999999999977999
000000000006600000066000000000000000000000000000000000000000000000000000000000000000000000000000cccbccbcbbcccbcc99aa79997a999999
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cbcbbcccccccbccc999a99799a999999
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccbbcccbbcccccc99999a99999aa999
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccbcccbbcbbbc00999999999997990
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ccccccccbcbbcc00999a997a99a7990
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccccccccccc000099979799799900
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccccccccc000000999999aa99000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccccccc00000000999999990000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077770000000000009999000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088880008000000002222000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000888888800008000022222d22eee0
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000888888800880000022222dd222ee0
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008888888000000000222dd2d222ee00
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088888880000808002222d22222ee220
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008888880008008800222222222ee2220
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008888888800008888222d22222ee22222
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000888888888008888822dd2222ee222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088888888888888882dd2222ee2222dd2
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088888888888888882dd222ee2222dd22
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088888888888888002222ee2222dd220
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008888888888888800222ee2222222220
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000888888888888000e2ee22222222200
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088888888880000eee222dd2222000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088888888000000e022dd22220000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088880000000000002222000000
