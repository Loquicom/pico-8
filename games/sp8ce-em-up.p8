pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--gameloop

function _init()
	init_ground()
	make_player()
end

function _update()
	update_ground()
	move_player()
end

function _draw()
	cls(1) --clear screen
	draw_background()
	draw_player()
	draw_foreground()
end

-->8
--player

function make_player()
	player = {}
	player.sprite = 1
	player.x = 64
	player.y = 64
	player.speed = 2
end

function move_player()
	-- Detect pressed button set speed end sprite
	local x = 0
	local y = 0
	player.sprite = 1
	if (btn(0)) x -= player.speed
	if (btn(1)) x += player.speed
	if (btn(2)) then 
		y -= player.speed
		player.sprite = 3
	end
	if (btn(3)) then 
		y += player.speed
		player.sprite = 2
	end
	-- Adapt diagonal speed
	if (x != 0 & y != 0) then
		x /= 2
		y /= 2
	end
	-- Set position
	player.x += x
	player.y += y
end

function draw_player()
	spr(player.sprite,player.x,player.y)
end

-->8
--background & foreground

function init_ground()
	planet = {visible=false,speed=0.6}
	stars = {}
	ligths = {}
	for i=0,flr(rnd(10)+18) do
		add(ligths, {x=-2,speed=1.2})
	end
	for i=0,flr(rnd(4)+4) do
		add(stars, {x=-9,speed=0.2})
	end
end

function update_ground()
	-- Planet
	if (not planet.visible) then
		-- Show the planet, set the properties
		local type = flr(rnd(4)+0.1)
		if (type == 0) planet.sprite = 12
		if (type == 1) planet.sprite = 14
		if (type == 2) planet.sprite = 42
		if (type == 3) planet.sprite = 44
		if (type == 4) planet.sprite = 46
		planet.visible = true
		planet.x = 200
		planet.y = flr(rnd(127))
	end
	if (planet.visible) then
		if (planet.x < -100) planet.visible = false
		planet.x -= planet.speed
	end
	-- Stars
	for star in all(stars) do 
		if (star.x < -8) then
			local type = flr(rnd(3)+0.1)
			if (type == 0) star.sprite = 10
			if (type == 1) star.sprite = 11
			if (type == 2) star.sprite = 26
			if (type == 3) star.sprite = 27
			star.x = flr(rnd(250))+130
			star.y = flr(rnd(127))
		end
		star.x -= star.speed
	end
	-- Lights
	for light in all(ligths) do
		if (light.x < -1) then
			light.x = flr(rnd(100))+130
			light.y = flr(rnd(127))
			light.color = flr(rnd(2)+5)
		end
		light.x -= light.speed
		if (light.color == 6) light.x -= 0.2
	end
end

function draw_background()
	-- Stars
	for star in all(stars) do 
		spr(star.sprite, star.x, star.y)
	end
	-- Planet
	if (planet.visible) then
		spr(planet.sprite, planet.x, planet.y)
		spr(planet.sprite+1, planet.x+8, planet.y)
		spr(planet.sprite+16, planet.x, planet.y+8)
		spr(planet.sprite+17, planet.x+8, planet.y+8)
	end
end

function draw_foreground()
	for light in all(ligths) do
		if (light.color == 6) pset(light.x-1, light.y, light.color)
		pset(light.x, light.y, light.color)
	end
end

__gfx__
00000000000660000000000000066000000000000000000000000000000000000000000000000000000000000000000000000077770000000000009999000000
00000000006d600000000000665555d00000000000000000000000000000000000000000000000000000000000a0a0000000cccccccc00000000999799990000
00700700665555d00006600000655f550000000000000000000000000000000000000000000000000000000000070000000cccccccccc00000099999a9999000
0007700000655f55665d6000006555d500000000000000000000000000000000000000000000000000c0c00000a0a00000cccccccbcccc000099999999999900
0007700000655f55006555d5665d600000000000000000000000000000000000000000000000000000070000000000000cccccccccccccc009997aa999aa9990
00700700665555d000655f550006600000000000000000000000000000000000000000000000000000c0c000000000000ccbbccccbbbccc0099999999aa79990
00000000006d6000665555d0000000000000000000000000000000000000000000000000000000000000000000000000cccbbcccbbbbcccc9999999999977999
000000000006600000066000000000000000000000000000000000000000000000000000000000000000000000000000cccbccbcbbcccbcc99aa79997a999999
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cbcbbcccccccbccc999a99799a999999
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccbbcccbbcccccc99999a99999aa999
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000cccbcccbbcbbbc00999999999997990
000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000a7a0000ccccccccbcbbcc00999a997a99a7990
00000000000000000000000000000000000000000000000000000000000000000000000000000000000c7c00000a000000cccccccccccc000099979799799900
000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000cccccccccc000000999999aa99000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccccccc00000000999999990000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077770000000000009999000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000777700000000000088880008000000002222000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777700000000888888800008000022222d22ee00
000000000000000000000000000000000000000000000000000000000000000000000000000000000007777776777000000888888800880000022222dd222ee0
000000000000000000000000000000000000000000000000000000000000000000000000000000000077777677767700008888888000000000222dd2d2222ee0
000000000000000000000000000000000000000000000000000000000000000000000000000000000777777777777770088888888000808002222d222222eee0
0000000000000000000000000000000000000000000000000000000000000000000000000000000007767777767777700888888880800880022222222222ee20
0000000000000000000000000000000000000000000000000000000000000000000000000000000077777767777677778888888880008888222d2222d22eee22
000000000000000000000000000000000000000000000000000000000000000000000000000000007777777767777677888888888808888822dd222dd2eee222
00000000000000000000000000000000000000000000000000000000000000000000000000000000777767777777777788888888888888882dd222d22eee2dd2
00000000000000000000000000000000000000000000000000000000000000000000000000000000777777777767777788888888888888882dd22222eee2dd22
00000000000000000000000000000000000000000000000000000000000000000000000000000000076777777777677008888888888888800222222eee2dd220
0000000000000000000000000000000000000000000000000000000000000000000000000000000007777677677777700888888888888880022222eee2222220
00000000000000000000000000000000000000000000000000000000000000000000000000000000007777777777770000888888888888000e22eeee22222200
00000000000000000000000000000000000000000000000000000000000000000000000000000000000777767767700000088888888880000eeeeeedd2222000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000777777770000000088888888000000eee2dd22220000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000777700000000000088880000000000002222000000
